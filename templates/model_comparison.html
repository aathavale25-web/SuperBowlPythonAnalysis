{% extends "base.html" %}
{% set page = 'model_comparison' %}

{% block content %}
<h1>Model Comparison: Monte Carlo vs Hybrid ML</h1>
<p class="subtitle">Comparing two approaches to player prop predictions</p>

<style>
    .model-card {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin: 20px 0;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .comparison-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin: 20px 0;
    }
    .model-column {
        padding: 15px;
        border-radius: 8px;
    }
    .monte-carlo {
        background: linear-gradient(135deg, #e0f2fe 0%, #bfdbfe 100%);
        border-left: 4px solid #0284c7;
    }
    .hybrid {
        background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
        border-left: 4px solid #15803d;
    }
    .diff-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 0.85em;
        font-weight: bold;
        margin-left: 10px;
    }
    .diff-positive { background: #dcfce7; color: #15803d; }
    .diff-negative { background: #fee2e2; color: #dc2626; }
    .diff-neutral { background: #f3f4f6; color: #6b7280; }
    .stat-row {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid rgba(0,0,0,0.1);
    }
    .model-badge {
        display: inline-block;
        background: #002244;
        color: white;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.75em;
        font-weight: bold;
    }
    .methodology-card {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        padding: 20px;
        border-radius: 8px;
        margin: 30px 0;
    }
</style>

<!-- Methodology Comparison -->
<div class="methodology-card">
    <h2 style="margin-top: 0;">ðŸ“Š Methodology Comparison</h2>

    <div class="comparison-grid">
        <div class="model-column monte-carlo">
            <h3>Monte Carlo Simulation</h3>
            <p><strong>Approach:</strong> Statistical simulation (10,000 runs)</p>
            <ul style="font-size: 0.95em;">
                <li>Uses historical distribution</li>
                <li>Assumes normal distribution</li>
                <li>70% recent, 30% season weighting</li>
                <li>Simple, interpretable</li>
            </ul>
            <p style="margin-top: 15px;"><strong>Best for:</strong> Simple probabilities, no context needed</p>
        </div>

        <div class="model-column hybrid">
            <h3>Hybrid XGBoost + Poisson</h3>
            <p><strong>Approach:</strong> Machine Learning + Statistical</p>
            <ul style="font-size: 0.95em;">
                <li><span class="model-badge">XGBOOST</span> for yards (continuous)</li>
                <li><span class="model-badge">POISSON</span> for counts (TDs, receptions)</li>
                <li>Learns patterns from data</li>
                <li>Captures recent trends</li>
            </ul>
            <p style="margin-top: 15px;"><strong>Best for:</strong> Complex patterns, better accuracy</p>
        </div>
    </div>
</div>

<!-- Player Comparisons -->
{% for player_name, data in data.model_comparison.items() %}
<div class="model-card">
    <h2 style="color: #002244; margin-bottom: 15px;">
        {{ player_name }}
        <span style="color: #69BE28; font-size: 0.8em; font-weight: normal;">{{ data.position }}</span>
    </h2>

    {% for stat_key, stat_data in data.stats.items() %}
        {% if 'difference' in stat_data %}
        <div style="margin: 25px 0; padding: 20px; background: #f8f9fa; border-radius: 8px;">
            <h3 style="margin: 0 0 15px 0; color: #002244;">
                {{ stat_key.replace('_', ' ').title() }}
                {% if 'hybrid' in stat_data %}
                <span class="model-badge">{{ stat_data.hybrid.model_type.upper() }}</span>
                {% endif %}
            </h3>

            <div class="comparison-grid">
                <!-- Monte Carlo Column -->
                <div class="model-column monte-carlo">
                    <h4 style="margin-top: 0;">Monte Carlo</h4>
                    {% if 'monte_carlo' in stat_data %}
                    {% set mc = stat_data.monte_carlo %}
                    <div class="stat-row">
                        <span>Prediction:</span>
                        <strong>{{ "%.1f"|format(mc.prediction) }}</strong>
                    </div>
                    <div class="stat-row">
                        <span>80% Range:</span>
                        <span>{{ "%.0f"|format(mc.confidence_80[0]) }}-{{ "%.0f"|format(mc.confidence_80[1]) }}</span>
                    </div>
                    <div class="stat-row">
                        <span>Over {{ "%.1f"|format(mc.line) }}:</span>
                        <strong style="color: #0284c7;">{{ "%.1f"|format(mc.over_prob) }}%</strong>
                    </div>
                    {% endif %}
                </div>

                <!-- Hybrid Column -->
                <div class="model-column hybrid">
                    <h4 style="margin-top: 0;">Hybrid Model</h4>
                    {% if 'hybrid' in stat_data %}
                    {% set hy = stat_data.hybrid %}
                    <div class="stat-row">
                        <span>Prediction:</span>
                        <strong>{{ "%.1f"|format(hy.prediction) }}</strong>
                    </div>
                    <div class="stat-row">
                        <span>80% Range:</span>
                        <span>{{ "%.0f"|format(hy.confidence_80[0]) }}-{{ "%.0f"|format(hy.confidence_80[1]) }}</span>
                    </div>
                    <div class="stat-row">
                        <span>Over {{ "%.1f"|format(hy.line) }}:</span>
                        <strong style="color: #15803d;">{{ "%.1f"|format(hy.over_prob) }}%</strong>
                    </div>
                    <div class="stat-row">
                        <span>Features:</span>
                        <span style="font-size: 0.85em;">{{ hy.features|join(', ') }}</span>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Difference Summary -->
            {% if 'difference' in stat_data %}
            {% set diff = stat_data.difference %}
            <div style="margin-top: 15px; padding: 12px; background: white; border-radius: 6px; border-left: 4px solid #002244;">
                <strong>Difference:</strong>
                <span class="diff-badge {% if diff.prediction_diff > 5 %}diff-positive{% elif diff.prediction_diff < -5 %}diff-negative{% else %}diff-neutral{% endif %}">
                    {{ "%+.1f"|format(diff.prediction_diff) }} ({{ "%+.1f"|format(diff.prediction_diff_pct) }}%)
                </span>

                {% if diff.over_prob_diff|abs >= 10 %}
                <span style="margin-left: 15px;">
                    ðŸ“Š Over Probability:
                    <span class="diff-badge {% if diff.over_prob_diff > 0 %}diff-positive{% else %}diff-negative{% endif %}">
                        {{ "%+.1f"|format(diff.over_prob_diff) }}%
                    </span>
                </span>
                {% endif %}
            </div>
            {% endif %}
        </div>
        {% endif %}
    {% endfor %}
</div>
{% endfor %}

<!-- Key Takeaways -->
<div class="model-card" style="background: linear-gradient(135deg, #002244 0%, #69BE28 100%); color: white;">
    <h2 style="margin-top: 0; color: white;">ðŸŽ¯ Key Takeaways</h2>

    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 6px; margin: 10px 0;">
        <h3 style="color: white; margin-top: 0;">When Models Agree</h3>
        <p>When both models show similar probabilities (within 5%), the prediction is more reliable. Look for consensus picks.</p>
    </div>

    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 6px; margin: 10px 0;">
        <h3 style="color: white; margin-top: 0;">When Models Disagree</h3>
        <p>Large differences (>10%) suggest uncertainty or different pattern recognition. XGBoost may capture trends Monte Carlo misses.</p>
    </div>

    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 6px; margin: 10px 0;">
        <h3 style="color: white; margin-top: 0;">Recommendation</h3>
        <p><strong>Use Hybrid Model when:</strong> Recent performance shows clear trends, or when you want more sophisticated analysis.</p>
        <p><strong>Use Monte Carlo when:</strong> You want simple, conservative estimates or when sample size is small.</p>
    </div>
</div>

{% endblock %}
